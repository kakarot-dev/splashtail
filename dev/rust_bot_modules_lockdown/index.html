<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lockdown Module - AntiRaid Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AntiRaid Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="definitions"><a class="header" href="#definitions">Definitions</a></h1>
<ul>
<li>Critical Roles: the roles which are given to members and should hence be locked down. In essence, one can define a set of critical roles (hence the name) which are either the critical roles and defaults to the <code>@everyone</code> role if not set.</li>
</ul>
<h1 id="lockdown-types"><a class="header" href="#lockdown-types">Lockdown Types</a></h1>
<h2 id="quick-server-lockdown"><a class="header" href="#quick-server-lockdown">Quick Server Lockdown</a></h2>
<h3 id="specificity"><a class="header" href="#specificity">Specificity</a></h3>
<ul>
<li><code>0</code> (Lowest specificity)</li>
</ul>
<h3 id="rationale"><a class="header" href="#rationale">Rationale</a></h3>
<p>Quickly lockdown a server as fast as possible</p>
<h3 id="syntax"><a class="header" href="#syntax">Syntax</a></h3>
<ul>
<li><code>qsl</code></li>
</ul>
<h3 id="description"><a class="header" href="#description">Description</a></h3>
<p>Quick Lockdown allows for quickly locking down a server given the following permission overwrite setup:</p>
<ul>
<li>All critical roles must have View Channel and Send Messages. All other roles must not have View Channel and Send Messages</li>
</ul>
<p>Internally, <code>qsl</code> modifies only the critical roles to the locked down set of permissions. This requires much fewer API calls and is hence much faster than traditional lockdowns.</p>
<h2 id="traditional-server-lockdown"><a class="header" href="#traditional-server-lockdown">Traditional Server Lockdown</a></h2>
<h3 id="specificity-1"><a class="header" href="#specificity-1">Specificity</a></h3>
<ul>
<li><code>1</code> (TSL &gt; QSL as it updates all channels in a server)</li>
</ul>
<h3 id="rationale-1"><a class="header" href="#rationale-1">Rationale</a></h3>
<p>In many cases, the requirements for <code>qsl</code> are not feasible for servers to meet. In such a case, a traditional lockdown is needed.</p>
<h3 id="syntax-1"><a class="header" href="#syntax-1">Syntax</a></h3>
<ul>
<li><code>tsl</code></li>
</ul>
<h3 id="description-1"><a class="header" href="#description-1">Description</a></h3>
<p>Traditional Lockdown is a more traditional lockdown method. It is more flexible than <code>qsl</code> as it has no required prior setup. However, it is much slower and should be avoided if possible.</p>
<p>Internally, <code>tsl</code> works by iterating over all channels and setting the permission overwrites for all critical roles to the locked down set. This is a slow process and can take a long time for large servers. In addition, super large servers may have outages when using a <code>tsl</code> that a <code>qsl</code> may not lead to.</p>
<h2 id="single-channel-lockdown"><a class="header" href="#single-channel-lockdown">Single-Channel Lockdown</a></h2>
<h3 id="specificity-2"><a class="header" href="#specificity-2">Specificity</a></h3>
<ul>
<li><code>2</code> (SCL &gt; TSL as it updates a single channel)</li>
</ul>
<h3 id="rationale-2"><a class="header" href="#rationale-2">Rationale</a></h3>
<p>In some cases, only a single channel needs to be locked down. In such a case, a single-channel lockdown is needed.</p>
<h3 id="syntax-2"><a class="header" href="#syntax-2">Syntax</a></h3>
<ul>
<li><code>scl/&lt;channel_id&gt;</code></li>
</ul>
<p>Where <code>&lt;channel_id&gt;</code> is the ID of the channel to lockdown</p>
<h3 id="description-2"><a class="header" href="#description-2">Description</a></h3>
<p>Single-Channel Lockdown is a lockdown method that locks down a single channel.</p>
<p>Internally, <code>scl/&lt;channel_id&gt;</code> works by setting the permission overwrites for all critical roles to the locked down set for the specified channel. This is a fast process and is recommended for locking down a single channel.</p>
<h1 id="specificity-3"><a class="header" href="#specificity-3">Specificity</a></h1>
<p>When multiple lockdowns are made on the same item (which will now be called a <code>handle</code> from now on), there needs to be a way to know what lockdown owns/has the handle. In AntiRaid, this is controlled through specificity based on the rules:</p>
<ul>
<li>Rule 0: When a handle is locked, the priority is added without replacing older priorities. When a handle is unlocked, the priority is removed leading to its previous value.</li>
<li>Rule 1: A handle is controlled unlocked by a lockdown A if the lockdown (say, lockdown B) corresponding to the largest specificity that has locked the handle is less than the specificity of lockdown A. Otherwise, it is considered locked and cannot be modified by lockdown A.</li>
<li>Rule 2: The underlying permissions or permission overwrites of a role/channel are defined as the saved permissions/permission overwrites of the role/channel of the oldest possible lockdown which has saved said data.</li>
</ul>
<p>As an example, consider a case where a <code>tsl</code> is first applied and then an <code>scl/&lt;channel_id&gt;</code>. As per Rule 1, the <code>tsl</code> has a lower specificity than the <code>scl/&lt;channel_id&gt;</code> and so the <code>scl/&lt;channel_id&gt;</code> will also lock the channel handle. When the <code>tsl</code> is then removed, the channel is still locked by <code>scl/&lt;channel_id&gt;</code> which has a greater specificity. Hence, by Rule 1, the <code>scl/&lt;channel_id&gt;</code> locked channel will remain locked even after the <code>tsl</code> is removed as expected.</p>
<p>Next, consider what happens when the <code>scl/&lt;channel_id&gt;</code> is removed. As <code>tsl</code> stores the original channel permission overwrites of all channels and was created before the <code>scl/&lt;channel_id&gt;</code>, Rule 2 applies. Hence, the underlying permissions of the channel is considered to come from the <code>tsl</code>'s stored data and NOT the <code>scl/&lt;channel_id&gt;</code> which was set during the lockdown. This means that when the <code>scl/&lt;channel_id&gt;</code> is removed, the channel will revert to the permissions it had before the <code>tsl</code> was applied which was the original channels permissions.</p>
<p>As such, using Rules 1 and 2, the following holds true:</p>
<p><code>tsl + scl/&lt;channel_id&gt; - tsl - scl/&lt;channel_id&gt; = 0</code></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../dev/go_jobs/backups.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../dev/rust_silverpelt/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../dev/go_jobs/backups.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../dev/rust_silverpelt/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
