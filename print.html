<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>AntiRaid Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AntiRaid Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>NOTE:</strong> Just adding AntiRaid (or any discord bot) to your server will not do much unless you configure it first!</p>
<p>AntiRaid is a discord bot that takes a very unique approach to protecting servers. Instead of providing a single-size-fits-all solution, AntiRaid makes use of "structured templating" and a (work in progress/coming soon) template shop to allow servers to protect themselves in a way that is tailored to them.</p>
<h2 id="our-philosophy"><a class="header" href="#our-philosophy">Our Philosophy</a></h2>
<p>While many bots like Wick provide a managed anti-raid/anti-nuke solution, these systems often provide suboptimal user experience to many servers as they may not cater to specific needs of the server. Wick, for example, is often criticized for limiting the abilities of server moderators in a way that makes moderation harder. While Wick is useful in many servers and does work quite well in the anti-raid/anti-nuke field from our experience, it may not be the best solution for all servers.</p>
<p>Templating, on the other hand, allows servers to tailor their needs directly without needing to go through the pain of making a custom discord bot, hosting it and then navigating the complexities of the discord API manually while reinventing concepts like stings/punishments/permissions/captchas all over again.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="permissions"><a class="header" href="#permissions">Permissions</a></h1>
<p>Imagine. Imagine a discord bot that you could completely control. You could decide who can use any specific command, who can change the bot's settings, and who can even use the bot at all.</p>
<p><em>Thats AntiRaid...</em></p>
<p>AntiRaid has a customizable permission system that uses both Discord permissions for simplicity and <a href="https://github.com/InfinityBotList/kittycat">kittycat</a> permissions for more specific requirements. For more complex cases, AntiRaid provides support for Lua scripting, which can be used to extend Antiraid with arbitrarily complex permission systems, among other things.</p>
<p>The idea is simple: All roles have permissions attached to them and members can have special permission overrides. The members' permissions are then checked when a command is run.</p>
<h2 id="modes"><a class="header" href="#modes">Modes</a></h2>
<p>Anti-Raid has two different modes for permission checks depending on how custom your needs are:</p>
<ul>
<li><code>Simple</code>: In simple mode, just specify the exact permissions needed to run a command. This is the default mode.</li>
<li><code>Template</code>: If you have more advanced needs, use custom templates to determine if a user has the required permissions. See <a href="user/permissions/../templating-lua/1-intro.html"><code>Templating</code></a> for more information on how templating works.</li>
</ul>
<h2 id="simple-permission-checks"><a class="header" href="#simple-permission-checks">Simple Permission Checks</a></h2>
<p>Since not everyone knows how to code, AntiRaid provides a simple permission-checking system built in that should be enough for most:</p>
<ol>
<li>Commands can have permissions that gate actions.</li>
<li>Commands can be either real or virtual. Real commands can be run. Virtual commands are placeholders for permission-gating actions.</li>
<li>Commands can be configured by setting their permissions or disabling them (some commands cannot be disabled to avoid breakage).</li>
<li>Server admins can set permissions on their server roles and then override them for specific users through permission overrides.</li>
<li>Server admins can then set permissions on commands and default permissions on modules. These permissions are then checked when a command is run.</li>
</ol>
<h2 id="template-permission-checks"><a class="header" href="#template-permission-checks">Template Permission Checks</a></h2>
<p>For more advanced users, AntiRaid provides a template system that allows you to create custom permission checks. This is done through custom Luau templating.</p>
<p>See the <a href="user/permissions/../templating-lua/1-intro.html">templating guide</a> for more information on how to use Lua templates. Then, just code away!</p>
<h2 id="tip"><a class="header" href="#tip">TIP</a></h2>
<p>For best results, consider limiting the server permissions of other users to the minimum required. Then, use AntiRaid for actual moderation. That's better than giving everyone admin permissions and then trying to restrict them with AntiRaid.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="templating"><a class="header" href="#templating">Templating</a></h1>
<p>At AntiRaid, we prioritize flexibility and customization for our users. To this end, our bot supports advanced templating to allow for extensive personalization of embeds and messages. While many bots utilize proprietary languages or templating engines, we have chosen to leverage Lua—a renowned scripting language widely used in game development and other applications. This decision ensures that our users benefit from a powerful, well-documented, and versatile language, enhancing the capability and ease of customizing their AntiRaid experience.</p>
<p><strong>Note: this documentation is still a work-in-progress and things are still being documented better and better by the day!</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lua-templating"><a class="header" href="#lua-templating">Lua Templating</a></h1>
<p>At AntiRaid, we prioritize flexibility and customization for our users. To this end, our bot supports advanced templating to allow for extensive personalization of embeds and messages. While many bots utilize proprietary languages or templating engines, we have chosen to leverage Lua—a renowned scripting language widely used in game development and other applications. This decision ensures that our users benefit from a powerful, well-documented, and versatile language, enhancing the capability and ease of customizing their AntiRaid experience.</p>
<p>Specifically, Anti Raid uses a variant of Lua called Luau. If you've ever used Roblox before, this is the same variant of Lua used there too (which is why Luau is also known as Roblox Lua in many places). You can check out the <a href="https://luau-lang.org/">Luau docs</a> for more information on the language itself. Unlike PUC Lua (the reference implementation), Luau is both faster and offers robust sandboxing capabilities allowing AntiRaid to run scripts in as safe an environment as possible.</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<p>Note that the remainder of these docs will cover AntiRaids Lua SDKs. To learn more about Lua itself, please checkout Lua's official tutorial for Lua 5.0 <a href="https://www.lua.org/pil/1.html">here</a>. Other resources for Lua exist (Lua is very popular after all), including <a href="https://devforum.roblox.com/t/lua-scripting-starter-guide/394618#print-5">Roblox's tutorial</a> (ignore the Studio bits), <a href="https://www.tutorialspoint.com/lua/lua_quick_guide.htm">TutorialPoint</a> and <a href="https://www.codecademy.com/learn/learn-lua">Codecademy</a>.</p>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<p>AntiRaid applies the following 3 global limits to all Lua templates. Note that we may provide increased limits as a Premium feature in the future:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub const MAX_TEMPLATE_MEMORY_USAGE: usize = 1024 * 1024 * 3; // 3MB maximum memory
pub const MAX_TEMPLATE_LIFETIME: std::time::Duration = std::time::Duration::from_secs(60 * 15); // 15 minutes maximum lifetime
pub const MAX_TEMPLATES_EXECUTION_TIME: std::time::Duration = std::time::Duration::from_secs(30); // 30 seconds maximum execution time
<span class="boring">}</span></code></pre></pre>
<p>The above limits are in place to prevent abuse and ensure that the bot remains responsive. If you require increased limits, please contact support (once again, this may change in the future).</p>
<h2 id="some-key-notes"><a class="header" href="#some-key-notes">Some key notes</a></h2>
<ul>
<li>Each guild is assigned a dedicated Lua VM. This VM is used to execute Lua code that is used in the templates.</li>
<li>The total memory usage that a guild can use is limited to <code>MAX_TEMPLATE_MEMORY_USAGE</code> (currently 3MB). This is to prevent a single guild from using too much memory.</li>
<li>Execution of all scripts is timed out when the last executed script takes longer than <code>MAX_TEMPLATES_EXECUTION_TIME</code> (currently 30 seconds).</li>
<li>A lua VM will exist for a total of <code>MAX_TEMPLATE_LIFETIME</code> (currently 10 minutes) after the last access before being destroyed. This is to reduce memory+CPU usage.</li>
<li>The <code>__stack</code> table can be used to share data across templates safely <em>while the VM is running</em>. without affecting other templates. This is useful for sharing data between templates such as Audit Logs. <strong>Note that AntiRaid uses luau sandboxing meaning that <code>_G</code> is readonly.</strong></li>
<li>The standard <code>require</code> statement can be used to import AntiRaid modules. <strong>Note that the modules are read-only</strong> and cannot be monkey-patched etc.</li>
<li><strong>Because Lua is a single-threaded language, only one template can be executed at a time</strong></li>
</ul>
<p>There are 2 valid syntax for a Luau template:</p>
<ol>
<li>Lua script syntax</li>
</ol>
<pre><code class="language-lua">local args, token = ...
-- Do something
return output
</code></pre>
<ol start="2">
<li>Function expression syntax (not recommended for new code)</li>
</ol>
<pre><code class="language-lua">function(args, token)
    -- Do something
    return output
end
</code></pre>
<p>Note that option 1 is recommended as it is both more idiomatic and is also valid syntax for LSP's and Luau parsers. Note that option 2 is actually converted to option 1 internally through the below wrapper:</p>
<pre><code>local args, token = ...
{function body here}
</code></pre>
<h2 id="interop"><a class="header" href="#interop">Interop</a></h2>
<p>Many features of Lua don't work so well when calling functions within the AntiRaid SDK. For example, both arrays and maps are expressed as tables in Lua. However, AntiRaid, being written in Rust, doesn't know this and hance needs some help to convert certain types for FFI. This is where the <code>@antiraid/interop</code> module comes in.</p>
<h3 id="arrays"><a class="header" href="#arrays">Arrays</a></h3>
<p>To pass arrays to modules within the AntiRaid SDK, you need to set the metatable to <code>@antiraid/interop#array_metatable</code>. This will allow the SDK to convert the array to a Rust <code>Vec</code> internally.</p>
<pre><code class="language-lua">local interop = require '@antiraid/interop'
setmetatable({a = 5}, interop.array_metatable)
</code></pre>
<h3 id="null"><a class="header" href="#null">Null</a></h3>
<p>While the Lua <code>nil</code> does work in many cases (and even when calling the SDK), its not the best choice. When querying AntiRaid SDK, the SDK will use the <code>@antiraid/interop#null</code> value to represent a null value. Your Lua templates can also use this value if desired</p>
<pre><code class="language-lua">local interop = require '@antiraid/interop'
local null = interop.null -- This is the null value
</code></pre>
<h3 id="memory-usage"><a class="header" href="#memory-usage">Memory Usage</a></h3>
<p>While not strictly useful for interop, it is often desirable to know the memory usage of a Lua template as AntiRaid will kill your template if it exceeds the memory limit. For this, you can use the <code>@antiraid/interop#memusage</code> function.</p>
<pre><code class="language-lua">local interop = require '@antiraid/interop'
print(interop.memusage())
</code></pre>
<h3 id="user-error-vs-runtime-error"><a class="header" href="#user-error-vs-runtime-error">User Error vs Runtime Error</a></h3>
<p>As Lua does not have a built-in way to distinguish between user errors and runtime errors, AntiRaid provides a way to do so. Simply return a table with the key <code>__error</code> set, and the value set to the error message to create a user error. You can use the standard <code>error</code> function for runtime errors. E.g.</p>
<pre><code class="language-lua">-- User Error
return { __error = "You have reached the maximum number of tries in this 5 minute window." }

-- Runtime Error
error("Could not parse user ID for some reason")
</code></pre>
<h2 id="template-tokens"><a class="header" href="#template-tokens">Template Tokens</a></h2>
<p>All Lua templates include a special template token in addition to the template arguments. "Executors" use this token to get access to the low-level per-template state. Examples of executors include the <code>@antiraid/actions</code> <code>ActionExecutor</code>, which allows you to perform actions such as banning/kicking/timing out users and other Discord actions and <code>@antiraid/kv</code> <code>KvExecutor</code> which allow for persistent storage via a key-value interface.</p>
<p>Note that token is randomly generated for each <em>template invocation</em> and is only guaranteed to be valid during a template execution. It is also guaranteed, however, that the created executor is complete and does not rely on the token itself whatsoever after creation. This means that a template executor can be used after the template has finished executing (e.g. in a coroutine).</p>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><code class="language-lua">local args, token = ...
print(token)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="antiraidasync"><a class="header" href="#antiraidasync">@antiraid/async</a></h1>
<p>Utilities for asynchronous operations and timing</p>
<h2 id="methods"><a class="header" href="#methods">Methods</a></h2>
<h3 id="sleep"><a class="header" href="#sleep">sleep</a></h3>
<pre><code class="language-lua">function sleep(duration: f64): f64
</code></pre>
<p>Sleep for a given duration.</p>
<h4 id="parameters"><a class="header" href="#parameters">Parameters</a></h4>
<ul>
<li><code>duration</code> (<a href="user/templating/2-plugins.html#type.f64">f64</a>): The duration to sleep for.</li>
</ul>
<h4 id="returns"><a class="header" href="#returns">Returns</a></h4>
<ul>
<li><code>slept_time</code> (<a href="user/templating/2-plugins.html#type.f64">f64</a>): The actual duration slept for.</li>
</ul>
<hr />
<h1 id="antiraidinterop"><a class="header" href="#antiraidinterop">@antiraid/interop</a></h1>
<p>This plugin allows interoperability with AntiRaid and controlled interaction with the low-levels of AntiRaid templating subsystem.</p>
<h2 id="types"><a class="header" href="#types">Types</a></h2>
<div id="type.null" />
<h3 id="null-1"><a class="header" href="#null-1">null</a></h3>
<p><code>null</code> is a special value that represents nothing. It is often used in AntiRaid instead of <code>nil</code> due to issues regarding existence etc. <code>null</code> is not equal to <code>nil</code> but is also an opaque type.</p>
<div id="type.array_metatable" />
<h3 id="array_metatable"><a class="header" href="#array_metatable">array_metatable</a></h3>
<p><code>array_metatable</code> is a special metatable that is used to represent arrays across the Lua-AntiRaid templating subsystem boundary. This metatable must be set on all arrays over this boundary and is required to ensure AntiRaid knows the value you're sending it is actually an array and not an arbitrary Luau table.</p>
<div id="type.TemplatePragma" />
<h3 id="templatepragma"><a class="header" href="#templatepragma">TemplatePragma</a></h3>
<p><code>TemplatePragma</code> contains the pragma of the template. Note that the list of fields below in non-exhaustive as templates can define extra fields on the pragma as well</p>
<pre><code class="language-json">{
  "lang": "lua",
  "allowed_caps": []
}
</code></pre>
<h4 id="fields"><a class="header" href="#fields">Fields</a></h4>
<ul>
<li><code>lang</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The language of the template.</li>
<li><code>allowed_caps</code> (<a href="user/templating/2-plugins.html#type.string">{string}</a>): The allowed capabilities provided to the template.</li>
</ul>
<div id="type.TemplateData" />
<h3 id="templatedata"><a class="header" href="#templatedata">TemplateData</a></h3>
<p><code>TemplateData</code> is a struct that represents the data associated with a template token. It is used to store the path and pragma of a template token.</p>
<pre><code class="language-json">{
  "path": "",
  "pragma": {
    "lang": "lua",
    "allowed_caps": []
  }
}
</code></pre>
<h4 id="fields-1"><a class="header" href="#fields-1">Fields</a></h4>
<ul>
<li><code>path</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The path of the template token.</li>
<li><code>pragma</code> (<a href="user/templating/2-plugins.html#type.TemplatePragma">TemplatePragma</a>): The pragma of the template.</li>
</ul>
<h2 id="methods-1"><a class="header" href="#methods-1">Methods</a></h2>
<h3 id="array_metatable-1"><a class="header" href="#array_metatable-1">array_metatable</a></h3>
<pre><code class="language-lua">function array_metatable(): table
</code></pre>
<p>Returns the array metatable.</p>
<h4 id="returns-1"><a class="header" href="#returns-1">Returns</a></h4>
<ul>
<li><code>array_metatable</code> (<a href="user/templating/2-plugins.html#type.table">table</a>): The array metatable.</li>
</ul>
<h3 id="null-2"><a class="header" href="#null-2">null</a></h3>
<pre><code class="language-lua">function null(): null
</code></pre>
<p>Returns the null value.</p>
<h4 id="returns-2"><a class="header" href="#returns-2">Returns</a></h4>
<ul>
<li><code>null</code> (<a href="user/templating/2-plugins.html#type.null">null</a>): The null value.</li>
</ul>
<h3 id="memusage"><a class="header" href="#memusage">memusage</a></h3>
<pre><code class="language-lua">function memusage(): f64
</code></pre>
<p>Returns the current memory usage of the Lua VM.</p>
<h4 id="returns-3"><a class="header" href="#returns-3">Returns</a></h4>
<ul>
<li><code>memory_usage</code> (<a href="user/templating/2-plugins.html#type.f64">f64</a>): The current memory usage, in bytes, of the Lua VM.</li>
</ul>
<h3 id="guild_id"><a class="header" href="#guild_id">guild_id</a></h3>
<pre><code class="language-lua">function guild_id(): string
</code></pre>
<p>Returns the current guild ID of the Lua VM.</p>
<h4 id="returns-4"><a class="header" href="#returns-4">Returns</a></h4>
<ul>
<li><code>guild_id</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The current guild ID.</li>
</ul>
<h3 id="gettemplatedata"><a class="header" href="#gettemplatedata">gettemplatedata</a></h3>
<pre><code class="language-lua">function gettemplatedata(token: string): TemplateData?
</code></pre>
<p>Returns the data associated with a template token.</p>
<h4 id="parameters-1"><a class="header" href="#parameters-1">Parameters</a></h4>
<ul>
<li><code>token</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The token of the template to retrieve data for.</li>
</ul>
<h4 id="returns-5"><a class="header" href="#returns-5">Returns</a></h4>
<ul>
<li><code>data</code> (<a href="user/templating/2-plugins.html#type.TemplateData">TemplateData?</a>): The data associated with the template token, or <code>null</code> if no data is found.</li>
</ul>
<h3 id="current_user"><a class="header" href="#current_user">current_user</a></h3>
<pre><code class="language-lua">function current_user(): serenity::model::user::User
</code></pre>
<p>Returns the current user of the Lua VM.</p>
<h4 id="returns-6"><a class="header" href="#returns-6">Returns</a></h4>
<ul>
<li><code>user</code> (<a href="https://docs.rs/serenity/latest/serenity/model/user/struct.User.html">serenity::model::user::User</a>): Returns AntiRaid's discord user object.</li>
</ul>
<hr />
<h1 id="antiraidimg_captcha"><a class="header" href="#antiraidimg_captcha">@antiraid/img_captcha</a></h1>
<p>This plugin allows for the creation of text/image CAPTCHA's with customizable filters which can be useful in protecting against bots.</p>
<h2 id="types-1"><a class="header" href="#types-1">Types</a></h2>
<div id="type.CaptchaConfig" />
<h3 id="captchaconfig"><a class="header" href="#captchaconfig">CaptchaConfig</a></h3>
<p>Captcha configuration. See examples for the arguments</p>
<pre><code class="language-json">{
  "char_count": 5,
  "filters": [
    {
      "filter": "Noise",
      "prob": 0.1
    },
    {
      "filter": "Wave",
      "f": 4.0,
      "amp": 2.0,
      "d": "horizontal"
    },
    {
      "filter": "Line",
      "p1": [
        1.0,
        0.0
      ],
      "p2": [
        20.0,
        20.0
      ],
      "thickness": 2.0,
      "color": {
        "r": 0,
        "g": 30,
        "b": 100
      }
    },
    {
      "filter": "RandomLine"
    },
    {
      "filter": "Grid",
      "y_gap": 30,
      "x_gap": 10
    },
    {
      "filter": "ColorInvert"
    }
  ],
  "viewbox_size": [
    512,
    512
  ],
  "set_viewbox_at_idx": null
}
</code></pre>
<h4 id="fields-2"><a class="header" href="#fields-2">Fields</a></h4>
<ul>
<li><code>filter</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The name of the filter to use. See example for the parameters to pass for the filter as well as https://github.com/Anti-Raid/captcha.</li>
</ul>
<h2 id="methods-2"><a class="header" href="#methods-2">Methods</a></h2>
<h3 id="new"><a class="header" href="#new">new</a></h3>
<pre><code class="language-lua">function new(config: CaptchaConfig): {u8}
</code></pre>
<p>Creates a new CAPTCHA with the given configuration.</p>
<h4 id="parameters-2"><a class="header" href="#parameters-2">Parameters</a></h4>
<ul>
<li><code>config</code> (<a href="user/templating/2-plugins.html#type.CaptchaConfig">CaptchaConfig</a>): The configuration to use for the CAPTCHA.</li>
</ul>
<h4 id="returns-7"><a class="header" href="#returns-7">Returns</a></h4>
<ul>
<li><code>captcha</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The created CAPTCHA object.</li>
</ul>
<hr />
<h1 id="antiraidkv"><a class="header" href="#antiraidkv">@antiraid/kv</a></h1>
<p>Utilities for key-value operations.</p>
<h2 id="types-2"><a class="header" href="#types-2">Types</a></h2>
<div id="type.KvRecord" />
<h3 id="kvrecord"><a class="header" href="#kvrecord">KvRecord</a></h3>
<p>KvRecord represents a key-value record with metadata.</p>
<pre><code class="language-json">{
  "key": "",
  "value": null,
  "exists": false,
  "created_at": null,
  "last_updated_at": null
}
</code></pre>
<h4 id="fields-3"><a class="header" href="#fields-3">Fields</a></h4>
<ul>
<li><code>key</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The key of the record.</li>
<li><code>value</code> (<a href="user/templating/2-plugins.html#type.any">any</a>): The value of the record.</li>
<li><code>exists</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): Whether the record exists.</li>
<li><code>created_at</code> (<a href="user/templating/2-plugins.html#type.datetime">datetime</a>): The time the record was created.</li>
<li><code>last_updated_at</code> (<a href="user/templating/2-plugins.html#type.datetime">datetime</a>): The time the record was last updated.</li>
</ul>
<div id="type.KvExecutor" />
<h3 id="kvexecutor"><a class="header" href="#kvexecutor">KvExecutor</a></h3>
<p>KvExecutor allows templates to get, store and find persistent data within a server.</p>
<h4 id="methods-3"><a class="header" href="#methods-3">Methods</a></h4>
<h5 id="kvexecutorfind"><a class="header" href="#kvexecutorfind">KvExecutor:find</a></h5>
<pre><code class="language-lua">function KvExecutor:find(key: string)
</code></pre>
<h6 id="parameters-3"><a class="header" href="#parameters-3">Parameters</a></h6>
<ul>
<li><code>key</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The key to search for. % matches zero or more characters; _ matches a single character. To search anywhere in a string, surround {KEY} with %, e.g. %{KEY}%</li>
</ul>
<h5 id="kvexecutorget"><a class="header" href="#kvexecutorget">KvExecutor:get</a></h5>
<pre><code class="language-lua">function KvExecutor:get(key: string)
</code></pre>
<h6 id="parameters-4"><a class="header" href="#parameters-4">Parameters</a></h6>
<ul>
<li><code>key</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The key to get.</li>
</ul>
<h6 id="returns-8"><a class="header" href="#returns-8">Returns</a></h6>
<ul>
<li><code>value</code> (<a href="user/templating/2-plugins.html#type.any">any</a>): The value of the key.- <code>exists</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): Whether the key exists.</li>
</ul>
<h5 id="kvexecutorgetrecord"><a class="header" href="#kvexecutorgetrecord">KvExecutor:getrecord</a></h5>
<pre><code class="language-lua">function KvExecutor:getrecord(key: string): KvRecord
</code></pre>
<h6 id="parameters-5"><a class="header" href="#parameters-5">Parameters</a></h6>
<ul>
<li><code>key</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The key to get.</li>
</ul>
<h6 id="returns-9"><a class="header" href="#returns-9">Returns</a></h6>
<ul>
<li><code>record</code> (<a href="user/templating/2-plugins.html#type.KvRecord">KvRecord</a>): The record of the key.</li>
</ul>
<h5 id="kvexecutorset"><a class="header" href="#kvexecutorset">KvExecutor:set</a></h5>
<pre><code class="language-lua">function KvExecutor:set(key: string, value: any)
</code></pre>
<h6 id="parameters-6"><a class="header" href="#parameters-6">Parameters</a></h6>
<ul>
<li><code>key</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The key to set.</li>
<li><code>value</code> (<a href="user/templating/2-plugins.html#type.any">any</a>): The value to set.</li>
</ul>
<h5 id="kvexecutordelete"><a class="header" href="#kvexecutordelete">KvExecutor:delete</a></h5>
<pre><code class="language-lua">function KvExecutor:delete(key: string)
</code></pre>
<h6 id="parameters-7"><a class="header" href="#parameters-7">Parameters</a></h6>
<ul>
<li><code>key</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The key to delete.</li>
</ul>
<h2 id="methods-4"><a class="header" href="#methods-4">Methods</a></h2>
<h3 id="new-1"><a class="header" href="#new-1">new</a></h3>
<pre><code class="language-lua">function new(token: string): KvExecutor
</code></pre>
<h4 id="parameters-8"><a class="header" href="#parameters-8">Parameters</a></h4>
<ul>
<li><code>token</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The token of the template to use.</li>
</ul>
<h4 id="returns-10"><a class="header" href="#returns-10">Returns</a></h4>
<ul>
<li><code>executor</code> (<a href="user/templating/2-plugins.html#type.KvExecutor">KvExecutor</a>): A key-value executor.</li>
</ul>
<hr />
<h1 id="antiraidpermissions"><a class="header" href="#antiraidpermissions">@antiraid/permissions</a></h1>
<p>Utilities for handling permission checks.</p>
<h2 id="types-3"><a class="header" href="#types-3">Types</a></h2>
<div id="type.PermissionResult" />
<h3 id="permissionresult"><a class="header" href="#permissionresult">PermissionResult</a></h3>
<p>PermissionResult is an internal type containing the status of a permission check in AntiRaid. The exact contents are undocumented as of now</p>
<div id="type.LuaPermissionResult" />
<h3 id="luapermissionresult"><a class="header" href="#luapermissionresult">LuaPermissionResult</a></h3>
<p>LuaPermissionResult is a type containing the status of a permission check in AntiRaid with prior parsing done for Lua.</p>
<pre><code class="language-json">{
  "result": {
    "var": "Ok"
  },
  "is_ok": true,
  "code": "Ok",
  "markdown": ""
}
</code></pre>
<h4 id="fields-4"><a class="header" href="#fields-4">Fields</a></h4>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.PermissionResult">PermissionResult</a>): The raw/underlying result of the permission check.</li>
<li><code>is_ok</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): Whether the permission check was successful.</li>
<li><code>code</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The code of the permission check.</li>
<li><code>markdown</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The markdown representation of the permission check.</li>
</ul>
<div id="type.PermissionCheck" />
<h3 id="permissioncheck"><a class="header" href="#permissioncheck">PermissionCheck</a></h3>
<p>PermissionCheck is a type containing the permissions to check for a user.</p>
<pre><code class="language-json">{
  "kittycat_perms": [],
  "native_perms": [],
  "outer_and": false,
  "inner_and": false
}
</code></pre>
<h4 id="fields-5"><a class="header" href="#fields-5">Fields</a></h4>
<ul>
<li><code>kittycat_perms</code> (<a href="user/templating/2-plugins.html#type.Permission">{Permission}</a>): The kittycat permissions needed to run the command.</li>
<li><code>native_perms</code> (<a href="user/templating/2-plugins.html#type.string">{string}</a>): The native permissions needed to run the command.</li>
<li><code>outer_and</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): Whether the next permission check should be ANDed (all needed) or OR'd (at least one) to the current</li>
<li><code>inner_and</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): Whether or not the perms are ANDed (all needed) or OR'd (at least one)</li>
</ul>
<div id="type.Permission" />
<h3 id="permission"><a class="header" href="#permission">Permission</a></h3>
<p>Permission is the primitive permission type used by AntiRaid. See https://github.com/InfinityBotList/kittycat for more information</p>
<pre><code class="language-json">{
  "namespace": "moderation",
  "perm": "ban",
  "negator": false
}
</code></pre>
<h4 id="fields-6"><a class="header" href="#fields-6">Fields</a></h4>
<ul>
<li><code>namespace</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The namespace of the permission.</li>
<li><code>perm</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The permission bit on the namespace.</li>
<li><code>negator</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): Whether the permission is a negator permission or not</li>
</ul>
<h2 id="methods-5"><a class="header" href="#methods-5">Methods</a></h2>
<h3 id="permission_from_string"><a class="header" href="#permission_from_string">permission_from_string</a></h3>
<pre><code class="language-lua">function permission_from_string(perm_string: string): Permission
</code></pre>
<p>Returns a Permission object from a string.</p>
<h4 id="parameters-9"><a class="header" href="#parameters-9">Parameters</a></h4>
<ul>
<li><code>perm_string</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The string to parse into a Permission object.</li>
</ul>
<h4 id="returns-11"><a class="header" href="#returns-11">Returns</a></h4>
<ul>
<li><code>permission</code> (<a href="user/templating/2-plugins.html#type.Permission">Permission</a>): The parsed Permission object.</li>
</ul>
<h3 id="permission_to_string"><a class="header" href="#permission_to_string">permission_to_string</a></h3>
<pre><code class="language-lua">function permission_to_string(permission: Permission): string
</code></pre>
<p>Returns a string from a Permission object.</p>
<h4 id="parameters-10"><a class="header" href="#parameters-10">Parameters</a></h4>
<ul>
<li><code>permission</code> (<a href="user/templating/2-plugins.html#type.Permission">Permission</a>): The Permission object to parse into a string.</li>
</ul>
<h4 id="returns-12"><a class="header" href="#returns-12">Returns</a></h4>
<ul>
<li><code>perm_string</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The parsed string.</li>
</ul>
<h3 id="has_perm"><a class="header" href="#has_perm">has_perm</a></h3>
<pre><code class="language-lua">function has_perm(permissions: {Permission}, permission: Permission): bool
</code></pre>
<p>Checks if a list of permissions in Permission object form contains a specific permission.</p>
<h4 id="parameters-11"><a class="header" href="#parameters-11">Parameters</a></h4>
<ul>
<li><code>permissions</code> (<a href="user/templating/2-plugins.html#type.Permission">{Permission}</a>): The list of permissions</li>
<li><code>permission</code> (<a href="user/templating/2-plugins.html#type.Permission">Permission</a>): The permission to check for.</li>
</ul>
<h4 id="returns-13"><a class="header" href="#returns-13">Returns</a></h4>
<ul>
<li><code>has_perm</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): Whether the permission is present in the list of permissions as per kittycat rules.</li>
</ul>
<h3 id="has_perm_str"><a class="header" href="#has_perm_str">has_perm_str</a></h3>
<pre><code class="language-lua">function has_perm_str(permissions: {string}, permission: string): bool
</code></pre>
<p>Checks if a list of permissions in canonical string form contains a specific permission.</p>
<h4 id="parameters-12"><a class="header" href="#parameters-12">Parameters</a></h4>
<ul>
<li><code>permissions</code> (<a href="user/templating/2-plugins.html#type.string">{string}</a>): The list of permissions</li>
<li><code>permission</code> (<a href="user/templating/2-plugins.html#type.string">string</a>): The permission to check for.</li>
</ul>
<h4 id="returns-14"><a class="header" href="#returns-14">Returns</a></h4>
<ul>
<li><code>has_perm</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): Whether the permission is present in the list of permissions as per kittycat rules.</li>
</ul>
<h3 id="check_perms_single"><a class="header" href="#check_perms_single">check_perms_single</a></h3>
<pre><code class="language-lua">function check_perms_single(check: PermissionCheck, member_native_perms: Permissions, member_kittycat_perms: {Permission}): LuaPermissionResult
</code></pre>
<p>Checks if a single permission check passes.</p>
<h4 id="parameters-13"><a class="header" href="#parameters-13">Parameters</a></h4>
<ul>
<li><code>check</code> (<a href="user/templating/2-plugins.html#type.PermissionCheck">PermissionCheck</a>): The permission check to evaluate.</li>
<li><code>member_native_perms</code> (<a href="user/templating/2-plugins.html#type.Permissions">Permissions</a>): The native permissions of the member.</li>
<li><code>member_kittycat_perms</code> (<a href="user/templating/2-plugins.html#type.Permission">{Permission}</a>): The kittycat permissions of the member.</li>
</ul>
<h4 id="returns-15"><a class="header" href="#returns-15">Returns</a></h4>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.LuaPermissionResult">LuaPermissionResult</a>): The result of the permission check.</li>
</ul>
<h3 id="eval_checks"><a class="header" href="#eval_checks">eval_checks</a></h3>
<pre><code class="language-lua">function eval_checks(checks: {PermissionCheck}, member_native_perms: Permissions, member_kittycat_perms: {Permission}): LuaPermissionResult
</code></pre>
<p>Evaluates a list of permission checks.</p>
<h4 id="parameters-14"><a class="header" href="#parameters-14">Parameters</a></h4>
<ul>
<li><code>checks</code> (<a href="user/templating/2-plugins.html#type.PermissionCheck">{PermissionCheck}</a>): The list of permission checks to evaluate.</li>
<li><code>member_native_perms</code> (<a href="user/templating/2-plugins.html#type.Permissions">Permissions</a>): The native permissions of the member.</li>
<li><code>member_kittycat_perms</code> (<a href="user/templating/2-plugins.html#type.Permission">{Permission}</a>): The kittycat permissions of the member.</li>
</ul>
<h4 id="returns-16"><a class="header" href="#returns-16">Returns</a></h4>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.LuaPermissionResult">LuaPermissionResult</a>): The result of the permission check.</li>
</ul>
<hr />
<h1 id="antiraidtypesext"><a class="header" href="#antiraidtypesext">@antiraid/typesext</a></h1>
<p>Extra types used by Anti-Raid Lua templating subsystem to either add in common functionality such as streams or handle things like u64/i64 types performantly.</p>
<h2 id="types-4"><a class="header" href="#types-4">Types</a></h2>
<div id="type.LuaStream" />
<h3 id="luastream"><a class="header" href="#luastream">LuaStream<T></a></h3>
<p>LuaStream<T> provides a stream implementation. This is returned by MessageHandle's await_component_interaction for instance for handling button clicks/select menu choices etc.</p>
<h4 id="methods-6"><a class="header" href="#methods-6">Methods</a></h4>
<h5 id="luastreamnext"><a class="header" href="#luastreamnext">LuaStream:next</a></h5>
<pre><code class="language-lua">function LuaStream:next(): &lt;T&gt;
</code></pre>
<p>Returns the next item in the stream.</p>
<h6 id="returns-17"><a class="header" href="#returns-17">Returns</a></h6>
<ul>
<li><code>item</code> (<code>&lt;T&gt;</code>): The next item in the stream.</li>
</ul>
<h5 id="luastreamfor_each"><a class="header" href="#luastreamfor_each">LuaStream:for_each</a></h5>
<pre><code class="language-lua">function LuaStream:for_each(callback: &lt;function&gt;)
</code></pre>
<p>Executes a callback for every entry in the stream.</p>
<h6 id="parameters-15"><a class="header" href="#parameters-15">Parameters</a></h6>
<ul>
<li><code>callback</code> (<code>&lt;function&gt;</code>): The callback to execute for each entry.</li>
</ul>
<div id="type.U64" />
<h3 id="u64"><a class="header" href="#u64">U64</a></h3>
<p>U64 is a 64-bit unsigned integer type. Implements Add/Subtract/Multiply/Divide/Modulus/Power/Integer Division/Equality/Comparison (Lt/Le and its complements Gt/Ge) and ToString with a type name of U64</p>
<h4 id="methods-7"><a class="header" href="#methods-7">Methods</a></h4>
<h5 id="u64to_ne_bytes"><a class="header" href="#u64to_ne_bytes">U64:to_ne_bytes</a></h5>
<pre><code class="language-lua">function U64:to_ne_bytes(): {u8}
</code></pre>
<p>Converts the U64 to a little-endian byte array.</p>
<h6 id="returns-18"><a class="header" href="#returns-18">Returns</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The little-endian byte array.</li>
</ul>
<h5 id="u64from_ne_bytes"><a class="header" href="#u64from_ne_bytes">U64:from_ne_bytes</a></h5>
<pre><code class="language-lua">function U64:from_ne_bytes(bytes: {u8}): U64
</code></pre>
<p>Converts a little-endian byte array to a U64.</p>
<h6 id="parameters-16"><a class="header" href="#parameters-16">Parameters</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The little-endian byte array.</li>
</ul>
<h6 id="returns-19"><a class="header" href="#returns-19">Returns</a></h6>
<ul>
<li><code>u64</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The U64 value.</li>
</ul>
<h5 id="u64to_le_bytes"><a class="header" href="#u64to_le_bytes">U64:to_le_bytes</a></h5>
<pre><code class="language-lua">function U64:to_le_bytes(): {u8}
</code></pre>
<p>Converts the U64 to a little-endian byte array.</p>
<h6 id="returns-20"><a class="header" href="#returns-20">Returns</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The little-endian byte array.</li>
</ul>
<h5 id="u64from_le_bytes"><a class="header" href="#u64from_le_bytes">U64:from_le_bytes</a></h5>
<pre><code class="language-lua">function U64:from_le_bytes(bytes: {u8}): U64
</code></pre>
<p>Converts a little-endian byte array to a U64.</p>
<h6 id="parameters-17"><a class="header" href="#parameters-17">Parameters</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The little-endian byte array.</li>
</ul>
<h6 id="returns-21"><a class="header" href="#returns-21">Returns</a></h6>
<ul>
<li><code>u64</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The U64 value.</li>
</ul>
<h5 id="u64to_be_bytes"><a class="header" href="#u64to_be_bytes">U64:to_be_bytes</a></h5>
<pre><code class="language-lua">function U64:to_be_bytes(): {u8}
</code></pre>
<p>Converts the U64 to a big-endian byte array.</p>
<h6 id="returns-22"><a class="header" href="#returns-22">Returns</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The big-endian byte array.</li>
</ul>
<h5 id="u64from_be_bytes"><a class="header" href="#u64from_be_bytes">U64:from_be_bytes</a></h5>
<pre><code class="language-lua">function U64:from_be_bytes(bytes: {u8}): U64
</code></pre>
<p>Converts a big-endian byte array to a U64.</p>
<h6 id="parameters-18"><a class="header" href="#parameters-18">Parameters</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The big-endian byte array.</li>
</ul>
<h6 id="returns-23"><a class="header" href="#returns-23">Returns</a></h6>
<ul>
<li><code>u64</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The U64 value.</li>
</ul>
<h5 id="u64to_i64"><a class="header" href="#u64to_i64">U64:to_i64</a></h5>
<pre><code class="language-lua">function U64:to_i64(): I64
</code></pre>
<p>Converts the U64 to an i64.</p>
<h6 id="returns-24"><a class="header" href="#returns-24">Returns</a></h6>
<ul>
<li><code>i64</code> (<a href="user/templating/2-plugins.html#type.I64">I64</a>): The i64 value.</li>
</ul>
<div id="type.I64" />
<h3 id="i64"><a class="header" href="#i64">I64</a></h3>
<p>I64 is a 64-bit signed integer type. Implements Add/Subtract/Multiply/Divide/Modulus/Power/Integer Division/Equality/Comparison (Lt/Le and its complements Gt/Ge) and ToString with a type name of I64</p>
<h4 id="methods-8"><a class="header" href="#methods-8">Methods</a></h4>
<h5 id="i64to_ne_bytes"><a class="header" href="#i64to_ne_bytes">I64:to_ne_bytes</a></h5>
<pre><code class="language-lua">function I64:to_ne_bytes(): {u8}
</code></pre>
<p>Converts the I64 to a little-endian byte array.</p>
<h6 id="returns-25"><a class="header" href="#returns-25">Returns</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The little-endian byte array.</li>
</ul>
<h5 id="i64from_ne_bytes"><a class="header" href="#i64from_ne_bytes">I64:from_ne_bytes</a></h5>
<pre><code class="language-lua">function I64:from_ne_bytes(bytes: {u8}): I64
</code></pre>
<p>Converts a little-endian byte array to a I64.</p>
<h6 id="parameters-19"><a class="header" href="#parameters-19">Parameters</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The little-endian byte array.</li>
</ul>
<h6 id="returns-26"><a class="header" href="#returns-26">Returns</a></h6>
<ul>
<li><code>i64</code> (<a href="user/templating/2-plugins.html#type.I64">I64</a>): The I64 value.</li>
</ul>
<h5 id="i64to_le_bytes"><a class="header" href="#i64to_le_bytes">I64:to_le_bytes</a></h5>
<pre><code class="language-lua">function I64:to_le_bytes(): {u8}
</code></pre>
<p>Converts the I64 to a little-endian byte array.</p>
<h6 id="returns-27"><a class="header" href="#returns-27">Returns</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The little-endian byte array.</li>
</ul>
<h5 id="i64from_le_bytes"><a class="header" href="#i64from_le_bytes">I64:from_le_bytes</a></h5>
<pre><code class="language-lua">function I64:from_le_bytes(bytes: {u8}): I64
</code></pre>
<p>Converts a little-endian byte array to a I64.</p>
<h6 id="parameters-20"><a class="header" href="#parameters-20">Parameters</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The little-endian byte array.</li>
</ul>
<h6 id="returns-28"><a class="header" href="#returns-28">Returns</a></h6>
<ul>
<li><code>i64</code> (<a href="user/templating/2-plugins.html#type.I64">I64</a>): The I64 value.</li>
</ul>
<h5 id="i64to_be_bytes"><a class="header" href="#i64to_be_bytes">I64:to_be_bytes</a></h5>
<pre><code class="language-lua">function I64:to_be_bytes(): {u8}
</code></pre>
<p>Converts the I64 to a big-endian byte array.</p>
<h6 id="returns-29"><a class="header" href="#returns-29">Returns</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The big-endian byte array.</li>
</ul>
<h5 id="i64from_be_bytes"><a class="header" href="#i64from_be_bytes">I64:from_be_bytes</a></h5>
<pre><code class="language-lua">function I64:from_be_bytes(bytes: {u8}): I64
</code></pre>
<p>Converts a big-endian byte array to a I64.</p>
<h6 id="parameters-21"><a class="header" href="#parameters-21">Parameters</a></h6>
<ul>
<li><code>bytes</code> (<a href="user/templating/2-plugins.html#type.u8">{u8}</a>): The big-endian byte array.</li>
</ul>
<h6 id="returns-30"><a class="header" href="#returns-30">Returns</a></h6>
<ul>
<li><code>i64</code> (<a href="user/templating/2-plugins.html#type.I64">I64</a>): The I64 value.</li>
</ul>
<h5 id="i64to_u64"><a class="header" href="#i64to_u64">I64:to_u64</a></h5>
<pre><code class="language-lua">function I64:to_u64(): U64
</code></pre>
<p>Converts the I64 to a U64.</p>
<h6 id="returns-31"><a class="header" href="#returns-31">Returns</a></h6>
<ul>
<li><code>u64</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The U64 value.</li>
</ul>
<div id="type.bitu64" />
<h3 id="bitu64"><a class="header" href="#bitu64">bitu64</a></h3>
<p><a href="https://luau.org/library#bit32-library">bit32</a> but for U64 datatype. Note that bit64 is experimental and may not be properly documented at all times. When in doubt, reach for Luau's bit32 documentation and simply replace 31's with 63's</p>
<h4 id="methods-9"><a class="header" href="#methods-9">Methods</a></h4>
<h5 id="bitu64band"><a class="header" href="#bitu64band">bitu64:band</a></h5>
<pre><code class="language-lua">function bitu64:band(...: &lt;U64&gt;): U64
</code></pre>
<p>Performs a bitwise AND operation on the given values.</p>
<h6 id="parameters-22"><a class="header" href="#parameters-22">Parameters</a></h6>
<ul>
<li><code>...</code> (<code>&lt;U64&gt;</code>): The values to perform the operation on.</li>
</ul>
<h6 id="returns-32"><a class="header" href="#returns-32">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The result of the operation.</li>
</ul>
<h5 id="bitu64bnor"><a class="header" href="#bitu64bnor">bitu64:bnor</a></h5>
<pre><code class="language-lua">function bitu64:bnor(n: U64): U64
</code></pre>
<p>Performs a bitwise NOR operation on the given value.</p>
<h6 id="parameters-23"><a class="header" href="#parameters-23">Parameters</a></h6>
<ul>
<li><code>n</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value to perform the operation on.</li>
</ul>
<h6 id="returns-33"><a class="header" href="#returns-33">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The result of the operation.</li>
</ul>
<h5 id="bitu64bor"><a class="header" href="#bitu64bor">bitu64:bor</a></h5>
<pre><code class="language-lua">function bitu64:bor(...: &lt;U64&gt;): U64
</code></pre>
<p>Performs a bitwise OR operation on the given values.</p>
<h6 id="parameters-24"><a class="header" href="#parameters-24">Parameters</a></h6>
<ul>
<li><code>...</code> (<code>&lt;U64&gt;</code>): The values to perform the operation on.</li>
</ul>
<h6 id="returns-34"><a class="header" href="#returns-34">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The result of the operation.</li>
</ul>
<h5 id="bitu64bxor"><a class="header" href="#bitu64bxor">bitu64:bxor</a></h5>
<pre><code class="language-lua">function bitu64:bxor(...: &lt;U64&gt;): U64
</code></pre>
<p>Performs a bitwise XOR operation on the given values.</p>
<h6 id="parameters-25"><a class="header" href="#parameters-25">Parameters</a></h6>
<ul>
<li><code>...</code> (<code>&lt;U64&gt;</code>): The values to perform the operation on.</li>
</ul>
<h6 id="returns-35"><a class="header" href="#returns-35">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The result of the operation.</li>
</ul>
<h5 id="bitu64btest"><a class="header" href="#bitu64btest">bitu64:btest</a></h5>
<pre><code class="language-lua">function bitu64:btest(...: &lt;U64&gt;): bool
</code></pre>
<p>Tests if the bitwise AND of the given values is not zero.</p>
<h6 id="parameters-26"><a class="header" href="#parameters-26">Parameters</a></h6>
<ul>
<li><code>...</code> (<code>&lt;U64&gt;</code>): The values to perform the operation on.</li>
</ul>
<h6 id="returns-36"><a class="header" href="#returns-36">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.bool">bool</a>): True if the bitwise AND of the values is not zero, false otherwise.</li>
</ul>
<h5 id="bitu64extract"><a class="header" href="#bitu64extract">bitu64:extract</a></h5>
<pre><code class="language-lua">function bitu64:extract(n: U64, f: u64, w: u64): U64
</code></pre>
<p>Extracts a field from a value.</p>
<h6 id="parameters-27"><a class="header" href="#parameters-27">Parameters</a></h6>
<ul>
<li><code>n</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value to extract the field from.</li>
<li><code>f</code> (<a href="user/templating/2-plugins.html#type.u64">u64</a>): The field to extract.</li>
<li><code>w</code> (<a href="user/templating/2-plugins.html#type.u64">u64</a>): The width of the field to extract.</li>
</ul>
<h6 id="returns-37"><a class="header" href="#returns-37">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The extracted field.</li>
</ul>
<h5 id="bitu64lrotate"><a class="header" href="#bitu64lrotate">bitu64:lrotate</a></h5>
<pre><code class="language-lua">function bitu64:lrotate(n: U64, i: i64): U64
</code></pre>
<p>Rotates a value left or right.</p>
<h6 id="parameters-28"><a class="header" href="#parameters-28">Parameters</a></h6>
<ul>
<li><code>n</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value to rotate.</li>
<li><code>i</code> (<a href="user/templating/2-plugins.html#type.i64">i64</a>): The amount to rotate by.</li>
</ul>
<h6 id="returns-38"><a class="header" href="#returns-38">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The rotated value.</li>
</ul>
<h5 id="bitu64lshift"><a class="header" href="#bitu64lshift">bitu64:lshift</a></h5>
<pre><code class="language-lua">function bitu64:lshift(n: U64, i: i64): U64
</code></pre>
<p>Shifts a value left or right.</p>
<h6 id="parameters-29"><a class="header" href="#parameters-29">Parameters</a></h6>
<ul>
<li><code>n</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value to shift.</li>
<li><code>i</code> (<a href="user/templating/2-plugins.html#type.i64">i64</a>): The amount to shift by.</li>
</ul>
<h6 id="returns-39"><a class="header" href="#returns-39">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The shifted value.</li>
</ul>
<h5 id="bitu64replace"><a class="header" href="#bitu64replace">bitu64:replace</a></h5>
<pre><code class="language-lua">function bitu64:replace(n: U64, v: U64, f: u64, w: u64): U64
</code></pre>
<p>Replaces a field in a value.</p>
<h6 id="parameters-30"><a class="header" href="#parameters-30">Parameters</a></h6>
<ul>
<li><code>n</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value to replace the field in.</li>
<li><code>v</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value to replace the field with.</li>
<li><code>f</code> (<a href="user/templating/2-plugins.html#type.u64">u64</a>): The field to replace.</li>
<li><code>w</code> (<a href="user/templating/2-plugins.html#type.u64">u64</a>): The width of the field to replace.</li>
</ul>
<h6 id="returns-40"><a class="header" href="#returns-40">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value with the field replaced.</li>
</ul>
<h5 id="bitu64rrotate"><a class="header" href="#bitu64rrotate">bitu64:rrotate</a></h5>
<pre><code class="language-lua">function bitu64:rrotate(n: U64, i: i64): U64
</code></pre>
<p>Rotates a value left or right.</p>
<h6 id="parameters-31"><a class="header" href="#parameters-31">Parameters</a></h6>
<ul>
<li><code>n</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value to rotate.</li>
<li><code>i</code> (<a href="user/templating/2-plugins.html#type.i64">i64</a>): The amount to rotate by.</li>
</ul>
<h6 id="returns-41"><a class="header" href="#returns-41">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The rotated value.</li>
</ul>
<h5 id="bitu64rshift"><a class="header" href="#bitu64rshift">bitu64:rshift</a></h5>
<pre><code class="language-lua">function bitu64:rshift(n: U64, i: i64): U64
</code></pre>
<p>Shifts a value left or right.</p>
<h6 id="parameters-32"><a class="header" href="#parameters-32">Parameters</a></h6>
<ul>
<li><code>n</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The value to shift.</li>
<li><code>i</code> (<a href="user/templating/2-plugins.html#type.i64">i64</a>): The amount to shift by.</li>
</ul>
<h6 id="returns-42"><a class="header" href="#returns-42">Returns</a></h6>
<ul>
<li><code>result</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The shifted value.</li>
</ul>
<h2 id="methods-10"><a class="header" href="#methods-10">Methods</a></h2>
<h3 id="u64-1"><a class="header" href="#u64-1">U64</a></h3>
<pre><code class="language-lua">function U64(value: u64): U64
</code></pre>
<p>Creates a new U64.</p>
<h4 id="parameters-33"><a class="header" href="#parameters-33">Parameters</a></h4>
<ul>
<li><code>value</code> (<a href="user/templating/2-plugins.html#type.u64">u64</a>): The value of the U64.</li>
</ul>
<h4 id="returns-43"><a class="header" href="#returns-43">Returns</a></h4>
<ul>
<li><code>u64</code> (<a href="user/templating/2-plugins.html#type.U64">U64</a>): The U64 value.</li>
</ul>
<h3 id="i64-1"><a class="header" href="#i64-1">I64</a></h3>
<pre><code class="language-lua">function I64(value: i64): I64
</code></pre>
<p>Creates a new I64.</p>
<h4 id="parameters-34"><a class="header" href="#parameters-34">Parameters</a></h4>
<ul>
<li><code>value</code> (<a href="user/templating/2-plugins.html#type.i64">i64</a>): The value of the I64.</li>
</ul>
<h4 id="returns-44"><a class="header" href="#returns-44">Returns</a></h4>
<ul>
<li><code>i64</code> (<a href="user/templating/2-plugins.html#type.I64">I64</a>): The I64 value.</li>
</ul>
<hr />
<h1 id="primitives"><a class="header" href="#primitives">Primitives</a></h1>
<div id="type.u8" />
<h2 id="u8"><a class="header" href="#u8">u8</a></h2>
<pre><code class="language-lua">type u8 = number
</code></pre>
<p>An unsigned 8-bit integer. <strong>Note: u8 arrays (<code>{u8}</code>) are often used to represent an array of bytes in AntiRaid</strong></p>
<h3 id="constraints"><a class="header" href="#constraints">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: 0-255)</li>
</ul>
<hr />
<div id="type.u16" />
<h2 id="u16"><a class="header" href="#u16">u16</a></h2>
<pre><code class="language-lua">type u16 = number
</code></pre>
<p>An unsigned 16-bit integer.</p>
<h3 id="constraints-1"><a class="header" href="#constraints-1">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: 0-65535)</li>
</ul>
<hr />
<div id="type.u32" />
<h2 id="u32"><a class="header" href="#u32">u32</a></h2>
<pre><code class="language-lua">type u32 = number
</code></pre>
<p>An unsigned 32-bit integer.</p>
<h3 id="constraints-2"><a class="header" href="#constraints-2">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: 0-4294967295)</li>
</ul>
<hr />
<div id="type.u64" />
<h2 id="u64-2"><a class="header" href="#u64-2">u64</a></h2>
<pre><code class="language-lua">type u64 = number
</code></pre>
<p>An unsigned 64-bit integer. <strong>Note that most, if not all, cases of <code>i64</code> in the actual API are either <code>string</code> or the <code>I64</code> custom type from typesext</strong></p>
<h3 id="constraints-3"><a class="header" href="#constraints-3">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: 0-18446744073709551615)</li>
</ul>
<hr />
<div id="type.i8" />
<h2 id="i8"><a class="header" href="#i8">i8</a></h2>
<pre><code class="language-lua">type i8 = number
</code></pre>
<p>A signed 8-bit integer.</p>
<h3 id="constraints-4"><a class="header" href="#constraints-4">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: -128-127)</li>
</ul>
<hr />
<div id="type.i16" />
<h2 id="i16"><a class="header" href="#i16">i16</a></h2>
<pre><code class="language-lua">type i16 = number
</code></pre>
<p>A signed 16-bit integer.</p>
<h3 id="constraints-5"><a class="header" href="#constraints-5">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: -32768-32767)</li>
</ul>
<hr />
<div id="type.i32" />
<h2 id="i32"><a class="header" href="#i32">i32</a></h2>
<pre><code class="language-lua">type i32 = number
</code></pre>
<p>A signed 32-bit integer.</p>
<h3 id="constraints-6"><a class="header" href="#constraints-6">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: -2147483648-2147483647)</li>
</ul>
<hr />
<div id="type.i64" />
<h2 id="i64-2"><a class="header" href="#i64-2">i64</a></h2>
<pre><code class="language-lua">type i64 = number
</code></pre>
<p>A signed 64-bit integer. <strong>Note that most, if not all, cases of <code>i64</code> in the actual API are either <code>string</code> or the <code>I64</code> custom type from typesext</strong></p>
<h3 id="constraints-7"><a class="header" href="#constraints-7">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: -9223372036854775808-9223372036854775807)</li>
</ul>
<hr />
<div id="type.f32" />
<h2 id="f32"><a class="header" href="#f32">f32</a></h2>
<pre><code class="language-lua">type f32 = number
</code></pre>
<p>A 32-bit floating point number.</p>
<h3 id="constraints-8"><a class="header" href="#constraints-8">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: IEEE 754 single-precision floating point)</li>
</ul>
<hr />
<div id="type.f64" />
<h2 id="f64"><a class="header" href="#f64">f64</a></h2>
<pre><code class="language-lua">type f64 = number
</code></pre>
<p>A 64-bit floating point number.</p>
<h3 id="constraints-9"><a class="header" href="#constraints-9">Constraints</a></h3>
<ul>
<li><strong>range</strong>: The range of values this number can take on (accepted values: IEEE 754 double-precision floating point)</li>
</ul>
<hr />
<div id="type.bool" />
<h2 id="bool"><a class="header" href="#bool">bool</a></h2>
<pre><code class="language-lua">type bool = boolean
</code></pre>
<p>A boolean value.</p>
<hr />
<div id="type.char" />
<h2 id="char"><a class="header" href="#char">char</a></h2>
<pre><code class="language-lua">type char = string
</code></pre>
<p>A single Unicode character.</p>
<h3 id="constraints-10"><a class="header" href="#constraints-10">Constraints</a></h3>
<ul>
<li><strong>length</strong>: The length of the string (accepted values: 1)</li>
</ul>
<hr />
<div id="type.string" />
<h2 id="string"><a class="header" href="#string">string</a></h2>
<pre><code class="language-lua">type string = string
</code></pre>
<p>A UTF-8 encoded string.</p>
<h3 id="constraints-11"><a class="header" href="#constraints-11">Constraints</a></h3>
<ul>
<li><strong>encoding</strong>: Accepted character encoding (accepted values: UTF-8 <em>only</em>)</li>
</ul>
<hr />
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-templates"><a class="header" href="#example-templates">Example Templates</a></h1>
<p>To help you get started with templating, we have provided a few examples below along with explanations of what/how they work</p>
<h2 id="example-1-simple-audit-logging"><a class="header" href="#example-1-simple-audit-logging">Example 1: Simple Audit Logging</a></h2>
<h3 id="explanation"><a class="header" href="#explanation">Explanation</a></h3>
<h4 id="1-pragma"><a class="header" href="#1-pragma">1. Pragma</a></h4>
<p>The first line of the template is a pragma. This is a special statement beginning with <code>@pragma</code> or <code>-- @pragma</code> that tells AntiRaid what language the template is written in, what options to use, and how tools such as CI, websites and other automation should handle your template. The rest of the pragma is a JSON object that contains the options. Note that if you do not provide a pragma, a default one will be used, however this will not allow you to provide capabilities to your template such as sending a message on Discord etc.</p>
<p>In this case, we want to tell AntiRaid that we are coding a template in Lua and that we want to allow the capability to send messages to Discord. This is done by adding the <code>allowed_caps</code> key to the pragma and specifying the capabilities we want to allow as seen below:</p>
<pre><code class="language-lua">-- @pragma {"lang":"lua","allowed_caps":["discord:create_message"]}
</code></pre>
<p>Another example of pragma is on the Website:</p>
<p><img src="user/templating/3-example-pragmaimg.png" alt="Pragma on website image" /></p>
<pre><code class="language-json">{"lang":"lua","builderInfo":{"ver":1,"data":{"embeds":[{"title":"Test","description":"","fields":[]}],"content":""},"checksum":"72e7225dfa2725a979fccc763e2e5bac3855f1cd3c10b5cd00c90b53e724db23"},"allowed_caps":["discord:create_message"]}
</code></pre>
<p>Here, notice that the builderInfo contains the embeds, content, and checksum of the template. When the user wants to reread their template, the website only has to reread the pragma statement to reconstruct the state and show the right tab (either Builder if they are just making a simple embed, or Advanced if they were making changes to the content of the template itself). Without the pragma, the website would have to use its own arcane syntax on top of comments or execute the template just to reconstruct state.</p>
<h4 id="2-creating-a-message"><a class="header" href="#2-creating-a-message">2. Creating a message</a></h4>
<p>Next, we need to extract the arguments and token from the context. The arguments are passed to the template when it is executed and contain all the data we need to work with. The token is used to authenticate the template and gain access to the templates context in privileged AntiRaid API's. All of this is provided using variable arguments.</p>
<pre><code class="language-lua">local args, token = ...
</code></pre>
<p>There are 3 things we want to import for this template to work. The first is the Discord module, which allows us to send messages to Discord. The second is the Interop module, which provides some functions allowing for seamless interoperability between your template and AntiRaid. The third is the Formatters module, which provides some helper methods for formatting audit log fields (formally known as <code>gwevent_fields</code>).</p>
<pre><code class="language-lua">local discord = require "@antiraid/discord"
local interop = require "@antiraid/interop"
local formatter = require "@antiraid/formatters"
</code></pre>
<p>Next, we create the embed. <code>args.event_titlename</code> is specific to Audit Logs and contains the friendly name for an event.</p>
<pre><code class="language-lua">-- Make the embed
local embed = {
    title = args.event_titlename, 
    description = "", -- Start with empty description
}
</code></pre>
<p><strong>NOTE: You can use the <a href="user/templating/./2-plugins.html">API Reference</a> to see what functions are available in the AntiRaid SDK</strong></p>
<h4 id="3-adding-fields"><a class="header" href="#3-adding-fields">3. Adding fields</a></h4>
<p><strong>TIP: When making a template for a Gateway Event, the fields are passed to the template through a table named <code>fields</code>.</strong></p>
<p>The next step is to add fields to the embed. In this case, we can do this by iterating over <code>fields</code>. In Lua, tables can be iterated over using the builtin <code>pairs</code> function like below:</p>
<pre><code class="language-lua">for key, value in pairs(my_table) do
    -- Do something with key and value
end
</code></pre>
<p>In the same way, we can now iterate over <code>args.event_data</code>:</p>
<pre><code class="language-lua">for key, value in pairs(args.event_data) do
    -- Do something with key and value
end
</code></pre>
<p>When using Audit Log Events, there are two cases to pay attention to, the first is the field itself being <code>nil</code> and the second is the field type being <code>None</code>. In both cases, we don't want to add the field to the embed. Lets do that!</p>
<pre><code class="language-lua">local should_set = false

if value ~= nil and value.field.type ~= "None" then
    should_set = true
end
</code></pre>
<p>Lastly, we need to format the field and add it to the description. Luckily, the formatter plugin provides a function for formatting any categorized field. This function is called <code>format_gwevent_field</code>.</p>
<pre><code class="language-lua">local formatted_value = formatter.format_gwevent_field(value)
</code></pre>
<h4 id="4-sending-the-message"><a class="header" href="#4-sending-the-message">4. Sending the message</a></h4>
<p>Finally, we can send the message using the Discord module. To do this, we need to create a message object and set the embeds property to an array containing our embed. This is also where interop comes in handy, as we need to set the metatable of the embeds array to the interop array metatable so AntiRaid knows that embeds is an array. Next, we use the Discord plugin to make a new Discord action executor which then lets us send the message to the specified channel (<code>args.sink</code> is another Audit Log specific variable that contains the channel ID/whatever <code>sink</code> is set to in the database).</p>
<pre><code class="language-lua">local message = { embeds = {} }
setmetatable(message.embeds, interop.array_metatable)

table.insert(message.embeds, embed)

-- Send message using action executor
local discord_executor = discord.new(token);
discord_executor:create_message({
    channel_id = args.sink,
    message = message
})
</code></pre>
<p>Finally, we can put the entire loop together as so:</p>
<pre><code class="language-lua">-- @pragma {"lang":"lua","allowed_caps":["discord:create_message"]}
local args, token = ...
local discord = require "@antiraid/discord"
local interop = require "@antiraid/interop"
local formatter = require "@antiraid/formatters"

-- Make the embed
local embed = {
    title = args.event_titlename, 
    description = "", -- Start with empty description
}

-- Add the event data to the description
for key, value in pairs(args.event_data) do
    local should_set = false

    if value ~= nil and value.type ~= "None" then
        should_set = true
    end

    if should_set then
        local formatted_value = formatter.format_gwevent_field(value)
        embed.description = embed.description .. "**" .. key:gsub("_", " "):upper() .. "**: " .. formatted_value .. "\n"
    end
end

local message = { embeds = {} }
setmetatable(message.embeds, interop.array_metatable)

table.insert(message.embeds, embed)

-- Send message using action executor
local discord_executor = discord.new(token);
discord_executor:create_message({
    channel_id = args.sink,
    message = message
})
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="luau-ecosystem-integration-notes"><a class="header" href="#luau-ecosystem-integration-notes">Luau Ecosystem Integration Notes</a></h1>
<p>At AntiRaid, we believe that bot developers should be able to access the best tools available to them. To this end, we have integrated some popular Luau libraries into our templating environment to provide a more powerful and flexible experience while taking into account security and stability of the bot. Below, we outline the libraries that are currently available for use in your Lua templates:</p>
<h2 id="libraries"><a class="header" href="#libraries">Libraries</a></h2>
<ul>
<li><a href="https://lune-org.github.io/docs/api-reference/datetime"><strong>@lune/datetime</strong></a></li>
<li><a href="https://lune-org.github.io/docs/api-reference/regex"><strong>@lune/regex</strong></a></li>
<li><a href="https://lune-org.github.io/docs/api-reference/serde"><strong>@lune/serde</strong></a></li>
</ul>
<h2 id="legal-disclaimer"><a class="header" href="#legal-disclaimer">Legal Disclaimer</a></h2>
<p>AntiRaid is not affiliated with any of the libraries mentioned above. We do not claim ownership of these libraries or their trademarks whatsoever, nor do we provide any guarantees or warranties regarding their functionality. AntiRaid absolves all liability for any damages or losses incurred through the use of these libraries, both to the libraries owner and to AntiRaid itself.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hooks-and-events"><a class="header" href="#hooks-and-events">Hooks And Events</a></h1>
<p>AntiRaid makes use of events for all communication between modules. Modules can either recieve events (e.g. from Discord) or generate their own events (such as PunishmentCreate/PunishmentExpire). This is what makes Anti-Raid so flexible and powerful, especially in templating.</p>
<p>Hooks is a module that listens for all Anti-Raid events and lets you dispatch a template whener an event is recieved (or generated) by Anti-Raid.</p>
<h2 id="discord-events"><a class="header" href="#discord-events">Discord Events</a></h2>
<p>Discord Events are special. AntiRaid uses Serenity for handling Discord events. As such, please see <a href="https://docs.rs/serenity/latest/serenity/client/enum.FullEvent.html#variants">Serenity's Documentation</a> for what fields are available in each event. It's much better documentation than what we can come up with.</p>
<p>AntiRaid does not modify the events in any way, so you can expect the same fields as what Serenity provides. Note, however, that only the fields are available to templates, not the methods provided by Serenity.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="captcha"><a class="header" href="#captcha">Captcha</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h1>
<p><em>WARNING: Captcha's are being heavily churned/rewritten into a new Lua plugin</em></p>
<p>A CAPTCHA is a security measure that can be used to try and filter out the more basic and spammy bots from accessing your server. It presents a challenge that users must complete to prove they are human. This can help protect your server from unwanted automated access and ensure that real users can interact with your community. <strong>Note that CAPTCHA's are NOT foolproof and that more sophistiated bots may still bypass them.</strong></p>
<p>Of course, with the current landscape with AI everywhere, just serving a single CAPTCHA type (or config) does not really work. Furthermore, AntiRaid recognizes that different servers have different needs. Therefore, we provide a flexible CAPTCHA system, fully integrated with our Lua Templating system that allows you to completely customize the CAPTCHA experience for your users. This occurs through filters.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="examples"><a class="header" href="#examples">Examples</a></h1>
<h2 id="sample-captcha"><a class="header" href="#sample-captcha">Sample CAPTCHA</a></h2>
<pre><code class="language-lua">local interop = require "@antiraid/interop"
local img_captcha = require "@antiraid/img_captcha"

local captcha_config = {}

-- Basic options
captcha_config.char_count = 7
captcha_config.filters = {}
setmetatable(captcha_config.filters, interop.array_metatable) -- Filters is an array
captcha_config.viewbox_size = { 280, 160 }
setmetatable(captcha_config.viewbox_size, interop.array_metatable) -- Viewbox size is a tuple

-- Add noise filter
local noise_filter = {
    filter = "Noise",
    prob = 0.05
}

table.insert(captcha_config.filters, noise_filter)

-- Add wave filter
local wave_filter = {
    filter = "Wave",
    f = 4.0, -- Frequency
    amp = 20.0, -- Amplitude
    d = "horizontal" -- Direction
}

table.insert(captcha_config.filters, wave_filter)

-- Add grid filter
local grid_filter = {
    filter = "Grid",
    x_gap = 10,
    y_gap = 30
}

table.insert(captcha_config.filters, grid_filter)

-- Add line filter
local line_filter = {
    filter = "Line",
    p1 = setmetatable({ 0.0, 0.0 }, interop.array_metatable),
    p2 = setmetatable({ 30.0, 100.0 }, interop.array_metatable),
    thickness = 7.0,
    color = setmetatable({ 0, 0, 0 }, interop.array_metatable)
}

table.insert(captcha_config.filters, line_filter)

-- Add color invert filter
local color_invert_filter = {
    filter = "ColorInvert"
}

table.insert(captcha_config.filters, color_invert_filter)

-- Add random line filter
local random_line_filter = {
    filter = "RandomLine"
}

table.insert(captcha_config.filters, random_line_filter)

local captcha = img_captcha.new(captcha_config)

return captcha
</code></pre>
<h2 id="captcha-with-increasing-char-count-with-maximum-of-5-tries-per-user"><a class="header" href="#captcha-with-increasing-char-count-with-maximum-of-5-tries-per-user">CAPTCHA with increasing char count with maximum of 5 tries per user</a></h2>
<pre><code class="language-lua">local args, token = ...
local interop = require "@antiraid/interop"
local img_captcha = require "@antiraid/img_captcha"

local captcha_config = {}

-- Check __stack.users
if __stack._captcha_user_tries == nil then
    __stack._captcha_user_tries = {} -- Initialize users table
end

-- Check __stack._captcha_user_tries[args.user.id]
if __stack._captcha_user_tries[args.user.id] == nil then
    __stack._captcha_user_tries[args.user.id] = 0 -- Initialize user's try count
end

-- Check if user has reached maximum tries
if __stack._captcha_user_tries[args.user.id] &gt;= 5 then
    return { __error = "You have reached the maximum number of tries in this 5 minute window."}
end

-- Basic options
captcha_config.char_count = math.min(7 + __stack._captcha_user_tries[args.user.id], 10) -- Increment the number of characters

captcha_config.filters = {}
setmetatable(captcha_config.filters, interop.array_metatable) -- Filters is an array
captcha_config.viewbox_size = { 280, 160 }
setmetatable(captcha_config.viewbox_size, interop.array_metatable) -- Viewbox size is a tuple

-- Increment the maximum number of tries
__stack._captcha_user_tries[args.user.id] += 1

captcha = img_captcha.new(captcha_config)
return captcha
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lockdowns"><a class="header" href="#lockdowns">Lockdowns</a></h1>
<p>Lockdowns are a way to allow restricting (or 'locking down') specific channels or roles within a server when under an attack or other such crises.</p>
<h2 id="migrating-from-other-bots"><a class="header" href="#migrating-from-other-bots">Migrating from other bots</a></h2>
<p>If you are coming from Wick or another anti-nuke bot like Wick, please note that AntiRaid's lockdown functionality only applies to locking down channels and roles. This means that the following Wick features are not present in AntiRaid lockdowns and are instead part of other more appropriate modules as listed below:</p>
<ul>
<li>Join Auto Kick (present in Inspector Auto Response Member Join)</li>
<li>Join Auto Ban (present in Inspector Auto Response Member Join)</li>
<li>Role Lockdown (WIP, not yet implemented)</li>
<li>All / Server Wide (Most likely will not be implemented)</li>
</ul>
<p>Note that blind lockdowns are not yet implemented in Anti-Raid.</p>
<p>For the sake of comparisons, here is how each lockdown mode compares to Wick's lockdown modes:</p>
<ul>
<li>Quick Server Lockdown (<code>qsl</code>) -&gt; Wick's Channels (<code>sc</code>) lockdown (general performance+requirements for use should be the same as Wick's lockdown feature)</li>
<li>Traditional Server Lockdown (<code>tsl</code>) -&gt; No equivalent in Wick</li>
<li>Single-Channel Lockdown (<code>scl</code>) -&gt; Wick's Channel (<code>c</code>) lockdown (note that locking down multiple specific channels at once is not yet implemented in AntiRaid)</li>
</ul>
<h2 id="usage-notes"><a class="header" href="#usage-notes">Usage Notes</a></h2>
<p>If you want to know more details on each type of lockdown, how they are applied and how multiple lockdown conflicts are resolved, please refer to the <a href="user/lockdown/../../dev/rust_bot_modules_lockdown/README.html">dev docs for lockdown</a></p>
<h2 id="member-roles"><a class="header" href="#member-roles">Member Roles</a></h2>
<p>When you first setup lockdown for the first time, you will be prompted for a set of member roles like below:</p>
<p><img src="user/lockdown/1-lockdowns-memberroles.png" alt="picture of member roles screen in settings page" /></p>
<p>These roles are what AntiRaid will actually lock-down which is why they are also known as 'critical roles'.</p>
<h2 id="quick-server-lockdowns"><a class="header" href="#quick-server-lockdowns">Quick Server Lockdowns</a></h2>
<p>For servers that can meet its restrictions, a quick server lockdown is the fastest way to lockdown your server in a raid. It is recommended to use this lockdown mode if possible. When using this mode, it is important to note one critical requirement:</p>
<ul>
<li>All critical roles must have View Channel and Send Messages. All other roles must not have View Channel and Send Messages.</li>
</ul>
<p>What this looks like is something like the following:</p>
<p><img src="user/lockdown/1-lockdowns-criticalroles1.png" alt="Picture of a normal role" />
<em>Figure 1 shows a normal role without View Channel of Send Messages permissions</em></p>
<p><img src="user/lockdown/1-lockdowns-criticalroles2.png" alt="Picture of a critical role" />
<em>Figure 2 shows a critical role with View Channel and Send Messages permissions</em></p>
<p>The above two figures are how you want to configure your critical/member and normal roles. Basically, turn off View Channel and Send Messages for all your normal roles and turn it on for your critical/member roles you set up earlier in the settings for lockdown.</p>
<p>To make a quick server lockdown, you can use the <code>qsl</code> type. For example, to lock down a server, you can use the following slash command:</p>
<pre><code>/lockdown lock type:qsl reason:There is a raid going on
</code></pre>
<h2 id="traditional-server-lockdown"><a class="header" href="#traditional-server-lockdown">Traditional Server Lockdown</a></h2>
<p>Traditional Server Lockdown is a more traditional lockdown method. It is more flexible than Quick Server Lockdown as it has no required prior setup. However, it is much slower and should be avoided if possible.</p>
<p><strong>WARNING:</strong> Super large servers may have outages when using a traditional server lockdown that a quick server lockdown may not lead to.</p>
<p>To make a traditional server lockdown, you can use the <code>tsl</code> type. For example, to lock down a server, you can use the following slash command:</p>
<pre><code>/lockdown lock type:tsl reason:There is a raid going on
</code></pre>
<h2 id="single-channel-lockdown"><a class="header" href="#single-channel-lockdown">Single-Channel Lockdown</a></h2>
<p>In some cases, only a single channel needs to be locked down. In such a case, a single-channel lockdown is needed.</p>
<p>To make a single-channel lockdown, you can use the <code>scl</code> type. For example, to lock down a server, you can use the following slash command:</p>
<pre><code>/lockdown lock type:scl/&lt;channel_id&gt; reason:There is a raid going on
</code></pre>
<p>Where <code>&lt;channel_id&gt;</code> is the ID of the channel to lockdown.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modifiers"><a class="header" href="#modifiers">Modifiers</a></h1>
<p>There are many cases where you want to either target or override settings for users/channels/roles/globally/other targets. This is where modifiers come in. Modifiers can be used to target users/channels/role/globally.</p>
<p>Each modifier is a string that can be used to target a specific user, channel, role, or globally. The following modifiers are available:</p>
<ul>
<li><strong>User ID</strong> - target a specific user (<code>user/{id}</code>, specificity = <code>3</code>)</li>
<li><strong>Channel ID</strong> - target a specific channel (<code>channel/{id}</code>, specificity = <code>2</code>)</li>
<li><strong>Role ID</strong> - target a specific role (<code>role/{id}</code>, specificity = <code>1</code>)</li>
<li><strong>Custom Variable</strong> - target a specific variable (<code>custom/{key}/{value}/{specificity}</code>, specificity = <code>{specificity}</code>)</li>
<li><strong>Global</strong> - target everything globally (guild-wide) (<code>global</code>, specificity = <code>0</code>)</li>
</ul>
<p>To allow handling conflicts between modifiers, each modifier has a specificity which is essentially a number as seen above.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backups"><a class="header" href="#backups">Backups</a></h1>
<h2 id="whats-backed-up"><a class="header" href="#whats-backed-up">What's backed up</a></h2>
<p>Guild structure (roles/channels/name/icon/other settings), some messages (Discord has limits here) and attachments (within reasonable limits).</p>
<h2 id="whats-not-backed-up"><a class="header" href="#whats-not-backed-up">What's not backed up?</a></h2>
<p>Members and bots. Note that for members, we have something coming up <em>soon</em> that may allow you to 'backup/restore' (with consent + regularly re-providing consent) members.</p>
<p>Note that new discord features may also not be backed up/restored immediately on release.</p>
<h2 id="more-details"><a class="header" href="#more-details">More details</a></h2>
<p>See the <a href="user/backups/../../dev/go_jobs/backups.html">dev guide</a> to learn more about the format</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="go-jobserver"><a class="header" href="#go-jobserver">Go Jobserver</a></h1>
<p>The Go Jobserver handles server backups, message prunes and other long running tasks on a server</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backups-1"><a class="header" href="#backups-1">Backups</a></h1>
<p><strong>Note that this document describes the technical details of the backup system</strong></p>
<h2 id="format"><a class="header" href="#format">Format</a></h2>
<p>A backup is an <a href="dev/go_jobs/iblfile">https://github.com/infinitybotlist/iblfile</a> with the standard <code>AutoEncryptedFile</code> format and has the following fields:</p>
<ul>
<li><code>backup_opts</code> - JSON containing a <code>types.BackupCreateOpts</code> object</li>
<li><code>core/guild</code> - The core guild data (<code>discordgo.Guild</code>)</li>
<li><code>assets/{asset_name}</code> - The guild icon data (<code>[]byte</code>)</li>
<li><code>messages/{channel_id}</code> - The messages in a channel along with basic attachment metadata (<code>[]types.BackupMessage</code>).</li>
<li><code>dbg/*</code> - Debug information. This may vary across backups and <strong>MUST NOT</strong> be used in restoring a backup.</li>
<li><code>attachments/{attachment_id}</code> - The attachments data itself</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="definitions"><a class="header" href="#definitions">Definitions</a></h1>
<ul>
<li>Critical Roles: the roles which are given to members and should hence be locked down. In essence, one can define a set of critical roles (hence the name) which are either the critical roles and defaults to the <code>@everyone</code> role if not set.</li>
</ul>
<h1 id="lockdown-types"><a class="header" href="#lockdown-types">Lockdown Types</a></h1>
<h2 id="quick-server-lockdown"><a class="header" href="#quick-server-lockdown">Quick Server Lockdown</a></h2>
<h3 id="specificity"><a class="header" href="#specificity">Specificity</a></h3>
<ul>
<li><code>0</code> (Lowest specificity)</li>
</ul>
<h3 id="rationale"><a class="header" href="#rationale">Rationale</a></h3>
<p>Quickly lockdown a server as fast as possible</p>
<h3 id="syntax"><a class="header" href="#syntax">Syntax</a></h3>
<ul>
<li><code>qsl</code></li>
</ul>
<h3 id="description"><a class="header" href="#description">Description</a></h3>
<p>Quick Lockdown allows for quickly locking down a server given the following permission overwrite setup:</p>
<ul>
<li>All critical roles must have View Channel and Send Messages. All other roles must not have View Channel and Send Messages</li>
</ul>
<p>Internally, <code>qsl</code> modifies only the critical roles to the locked down set of permissions. This requires much fewer API calls and is hence much faster than traditional lockdowns.</p>
<h2 id="traditional-server-lockdown-1"><a class="header" href="#traditional-server-lockdown-1">Traditional Server Lockdown</a></h2>
<h3 id="specificity-1"><a class="header" href="#specificity-1">Specificity</a></h3>
<ul>
<li><code>1</code> (TSL &gt; QSL as it updates all channels in a server)</li>
</ul>
<h3 id="rationale-1"><a class="header" href="#rationale-1">Rationale</a></h3>
<p>In many cases, the requirements for <code>qsl</code> are not feasible for servers to meet. In such a case, a traditional lockdown is needed.</p>
<h3 id="syntax-1"><a class="header" href="#syntax-1">Syntax</a></h3>
<ul>
<li><code>tsl</code></li>
</ul>
<h3 id="description-1"><a class="header" href="#description-1">Description</a></h3>
<p>Traditional Lockdown is a more traditional lockdown method. It is more flexible than <code>qsl</code> as it has no required prior setup. However, it is much slower and should be avoided if possible.</p>
<p>Internally, <code>tsl</code> works by iterating over all channels and setting the permission overwrites for all critical roles to the locked down set. This is a slow process and can take a long time for large servers. In addition, super large servers may have outages when using a <code>tsl</code> that a <code>qsl</code> may not lead to.</p>
<h2 id="single-channel-lockdown-1"><a class="header" href="#single-channel-lockdown-1">Single-Channel Lockdown</a></h2>
<h3 id="specificity-2"><a class="header" href="#specificity-2">Specificity</a></h3>
<ul>
<li><code>2</code> (SCL &gt; TSL as it updates a single channel)</li>
</ul>
<h3 id="rationale-2"><a class="header" href="#rationale-2">Rationale</a></h3>
<p>In some cases, only a single channel needs to be locked down. In such a case, a single-channel lockdown is needed.</p>
<h3 id="syntax-2"><a class="header" href="#syntax-2">Syntax</a></h3>
<ul>
<li><code>scl/&lt;channel_id&gt;</code></li>
</ul>
<p>Where <code>&lt;channel_id&gt;</code> is the ID of the channel to lockdown</p>
<h3 id="description-2"><a class="header" href="#description-2">Description</a></h3>
<p>Single-Channel Lockdown is a lockdown method that locks down a single channel.</p>
<p>Internally, <code>scl/&lt;channel_id&gt;</code> works by setting the permission overwrites for all critical roles to the locked down set for the specified channel. This is a fast process and is recommended for locking down a single channel.</p>
<h1 id="specificity-3"><a class="header" href="#specificity-3">Specificity</a></h1>
<p>When multiple lockdowns are made on the same item (which will now be called a <code>handle</code> from now on), there needs to be a way to know what lockdown owns/has the handle. In AntiRaid, this is controlled through specificity based on the rules:</p>
<ul>
<li>Rule 0: When a handle is locked, the priority is added without replacing older priorities. When a handle is unlocked, the priority is removed leading to its previous value.</li>
<li>Rule 1: A handle is controlled unlocked by a lockdown A if the lockdown (say, lockdown B) corresponding to the largest specificity that has locked the handle is less than the specificity of lockdown A. Otherwise, it is considered locked and cannot be modified by lockdown A.</li>
<li>Rule 2: The underlying permissions or permission overwrites of a role/channel are defined as the saved permissions/permission overwrites of the role/channel of the oldest possible lockdown which has saved said data.</li>
</ul>
<p>As an example, consider a case where a <code>tsl</code> is first applied and then an <code>scl/&lt;channel_id&gt;</code>. As per Rule 1, the <code>tsl</code> has a lower specificity than the <code>scl/&lt;channel_id&gt;</code> and so the <code>scl/&lt;channel_id&gt;</code> will also lock the channel handle. When the <code>tsl</code> is then removed, the channel is still locked by <code>scl/&lt;channel_id&gt;</code> which has a greater specificity. Hence, by Rule 1, the <code>scl/&lt;channel_id&gt;</code> locked channel will remain locked even after the <code>tsl</code> is removed as expected.</p>
<p>Next, consider what happens when the <code>scl/&lt;channel_id&gt;</code> is removed. As <code>tsl</code> stores the original channel permission overwrites of all channels and was created before the <code>scl/&lt;channel_id&gt;</code>, Rule 2 applies. Hence, the underlying permissions of the channel is considered to come from the <code>tsl</code>'s stored data and NOT the <code>scl/&lt;channel_id&gt;</code> which was set during the lockdown. This means that when the <code>scl/&lt;channel_id&gt;</code> is removed, the channel will revert to the permissions it had before the <code>tsl</code> was applied which was the original channels permissions.</p>
<p>As such, using Rules 1 and 2, the following holds true:</p>
<p><code>tsl + scl/&lt;channel_id&gt; - tsl - scl/&lt;channel_id&gt; = 0</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="silverpelt"><a class="header" href="#silverpelt">Silverpelt</a></h1>
<p>Silverpelt provides a standard library for all Anti-Raid modules.</p>
<p>To create a new Anti-Raid bot making use of Anti-Raid modules, simply implement the trait <code>silverpelt::module::Module</code>. These modules must then be added to a <code>SilverpeltCache</code> which is then inserted into <code>silverpelt::Data</code>.</p>
<p>Most things in silverpelt are abstracted out through traits or dispatched via events. This allows silverpelt to be used as an abstract interface allowing for Anti-Raid to quickly evolve and change/adapt to different targets.</p>
<p><strong>Note:</strong> AntiRaid uses a event-driven architecture. This means that modules+the main bot process make events that are dispatched to modules. The event system is currently passive (meaning there is no continously running event loop), however this is subject to change in the future.</p>
<h2 id="interfaces"><a class="header" href="#interfaces">Interfaces</a></h2>
<h3 id="sting"><a class="header" href="#sting">Sting</a></h3>
<p>Silverpelt provides concrete structures, utilities and special events for handling stings.</p>
<h3 id="punishments"><a class="header" href="#punishments">Punishments</a></h3>
<p>Silverpelt provides concrete structures, utilities and special events for handling punishments.</p>
<h2 id="some-extra-misc-points"><a class="header" href="#some-extra-misc-points">Some extra misc points</a></h2>
<ul>
<li>
<p>A command is the base unit for access control. This means that all operations with differing access controls must have commands associated with them.</p>
</li>
<li>
<p>This means that all operations (list backup, create/restore backup, delete backup) <em>MUST</em> have associated commands</p>
</li>
<li>
<p>Sometimes, an operation (such as a web-only operation) may not have a module/command associated with it. In such cases, a 'virtual' module should be used. Virtual modules are modules with commands that are not registered via Discord's API. They are used to group commands together for access control purposes and to ensure that each operation is tied to a command</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="anti-raid-templating-system"><a class="header" href="#anti-raid-templating-system">Anti-Raid Templating System</a></h1>
<h2 id="supported-languages"><a class="header" href="#supported-languages">Supported Languages</a></h2>
<ul>
<li>Lua (luau / Roblox Lua) - Tier 1</li>
</ul>
<p>Lua is the recommended language for templating</p>
<h2 id="wippotential-languages"><a class="header" href="#wippotential-languages">WIP/Potential Languages</a></h2>
<ul>
<li>JavaScript (see <code>lang_javascript_quickjs</code> and <code>lang_javascript_v8</code> for the current load experiments + integration experiments), potential but unlikely unless someone finds a solution</li>
<li>WebAssembly (potential, not yet decided)</li>
</ul>
<h2 id="language-requirements"><a class="header" href="#language-requirements">Language Requirements</a></h2>
<ol>
<li>All languages must export the following modules/helpers to the extent required as per the templating documentation. (TODO: Improve this spec)</li>
</ol>
<ul>
<li>Messages</li>
<li>Permissions</li>
<li>Captcha</li>
<li>Actions</li>
<li>Key Value API</li>
</ul>
<ol start="2">
<li>All languages must provide a way to sandbox the execution of the code. This is a security requirement. In particular, timeouts and heap/stack/memory limits are required.</li>
<li>Callers must use the abstracted out function calls from <code>lib.rs</code></li>
</ol>
<h2 id="my-language-vent"><a class="header" href="#my-language-vent">My language vent</a></h2>
<p><strong>For reference on my discord vents: https://discord.com/channels/763812938875535361/1040734156327501905/1267195190100361440</strong></p>
<p>Why is lua the only sane language for embedding
V8 has big ffi problems with rust. If you try spawning too many isolates, you have a 100% chance of aborting your process and this issue can only be resolved by performing unsafe void* pointer casts
Quickjs is a bit too slow and poorly documented
Rhai is good but it’s a custom language and it’s sandboxing abilities need unsafe code to fully work (and said unsafe code involves pointer arithmetic that is not thread safe) and heap memory limits require you to manually calculate the heap usage
Tera has virtually no safety features and will gladly execute an infinite recursion
For starlark/skylark, go to the point on rhai but hopefully without the unsafe bits
I can understand now why the game modding industry uses lua, it’s basically the only sane language for handling user input
Lua is legit the only sane scripting language on this entire list</p>
<p>[rhai is not only slower than lua, its sandboxing (i said it above here too in a vent i think) requires actual pointer arithmetic that isnt thread safe, its also a custom lang no one knows while lua is well known in the game community. Luau is used in Roblox games so it caters to Discords target market as well]</p>
<h1 id="template-tokens-1"><a class="header" href="#template-tokens-1">Template Tokens</a></h1>
<p>All lua templates include a special template token in addition to the template arguments. Modules requiring more privileged levels of access (or otherwise require the template state) should require this token and use it to access the required template state.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="text-difference-utilities"><a class="header" href="#text-difference-utilities">Text difference utilities</a></h1>
<p><strong>diff.rs:</strong> Taken from https://docs.rs/text-diff/latest/src/text_diff with some modernizing. All credits go to the author.</p>
<p>Other utilities are taken too. To be documented</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
